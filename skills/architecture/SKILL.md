---
name: cocos-architecture
description: Cocos Creator 架构知识。提供场景、节点、组件、预制体和资源的核心架构概念说明。当需要理解 Cocos Creator 的架构设计、实体关系或数据流时使用此技能。
---

# Cocos Creator 架构

Cocos Creator 的核心架构概念和实体关系。

## 核心概念

### 场景 (Scene)

场景是 Cocos Creator 中的顶级容器，包含游戏的所有内容。

- **文件格式**: `.scene`
- **路径格式**: `db://assets/scenes/xxx.scene`
- **作用**: 组织游戏对象的容器，类似于电影的"场"

### 节点 (Node)

节点是场景中的基本单位，构成树形层级结构。

```
Scene (场景)
├── Canvas (画布)
│   ├── Panel (面板)
│   │   ├── Button (按钮)
│   │   └── Label (标签)
│   └── Sprite (精灵)
└── Main Camera (主相机)
    └── Light (光源)
```

**节点属性**:
- `name`: 节点名称
- `active`: 是否激活
- `parent`: 父节点
- `children`: 子节点列表

**坐标系**:
- `world`: 世界坐标系 (相对于场景原点)
- `local`: 局部坐标系 (相对于父节点)

### 组件 (Component)

组件附加到节点上，为节点提供功能。

```
Node (节点)
├── Transform (变换) - 位置、旋转、缩放
├── Sprite (精灵) - 显示图片
├── Label (标签) - 显示文字
├── Button (按钮) - 交互响应
└── Script (脚本) - 自定义逻辑
```

**组件类型**:
- **内建组件**: Cocos Creator 提供的标准组件
- **脚本组件**: 用户编写的自定义组件

### 预制体 (Prefab)

预制体是可重用的节点模板。

- **文件格式**: `.prefab`
- **路径格式**: `db://assets/prefabs/xxx.prefab`
- **作用**: 创建可重用的对象模板

**预制体状态**:
- **绿色**: 预制体实例，无本地修改
- **蓝色**: 预制体实例，有本地修改
- **灰色**: 普通节点（已解除链接）

### 资源 (Asset)

资源是项目中使用的所有文件。

**常见资源类型**:
- 图片: `.png`, `.jpg`
- 音频: `.mp3`, `.wav`
- 字体: `.ttf`, `.otf`
- 脚本: `.ts`, `.js`
- 预制体: `.prefab`
- 场景: `.scene`

**资源路径格式**: `db://assets/...`

## 实体关系

```
┌─────────────────────────────────────────────────────────┐
│                      Project (项目)                      │
│  ┌───────────────────────────────────────────────────┐  │
│  │                Assets (资源库)                     │  │
│  │  ├── Prefabs (预制体)  ──┐                       │  │
│  │  ├── Scenes (场景)      │                       │  │
│  │  ├── Scripts (脚本)     │                       │  │
│  │  └── Textures (纹理)    │                       │  │
│  └──────────────────────────┼───────────────────────┘  │
│                             │                           │
│                             ▼                           │
│  ┌───────────────────────────────────────────────────┐  │
│  │              Scene (场景)                          │  │
│  │  ┌─────────────────────────────────────────────┐  │  │
│  │  │         Node Hierarchy (节点层级)           │  │  │
│  │  │  ┌─────────┐                                │  │  │
│  │  │  │ Root    │                                │  │  │
│  │  │  └────┬────┘                                │  │  │
│  │  │       │                                       │  │  │
│  │  │       ├─→ Node ──→ Components ──→ Scripts  │  │  │
│  │  │       │                   └─→ Assets     │  │  │
│  │  │       └─→ Prefab Instance ──→ Prefab Asset │  │  │
│  │  └─────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

## 数据流向

```
用户输入 → 节点 → 组件 → 脚本逻辑 → 修改节点属性 → 渲染
    ↑                                                    ↓
    └────────────────── 事件系统 ←──────────────────────┘
```

## 生命周期

### 场景生命周期

```
加载 → 初始化 → 运行 → 暂停 → 恢复 → 销毁
```

### 节点生命周期

```
创建 → 激活 → 更新 → 停用 → 销毁
```

### 组件生命周期

```
附加 → onLoad → start → update → lateUpdate → onDisable → onDestroy
```

## 设计原则

### 组合优于继承

Cocos Creator 使用组件系统而非继承：
- 将功能拆分为独立的组件
- 通过组合组件来创建复杂行为
- 组件可以动态添加/移除

### 数据驱动

- 节点属性可在编辑器中配置
- 预制体实例可以有自己的属性覆盖
- 资源引用通过 UUID 管理

### 事件驱动

- 节点间通过事件通信
- 组件通过生命周期回调响应状态变化
- 广播系统实现跨层级通信
